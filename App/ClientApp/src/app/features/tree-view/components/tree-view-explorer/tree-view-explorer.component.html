<div class="tree-view">
  <ul class="list-group">
    <!-- Only subscribe to the observable once at the top level -->
    <ng-container *ngIf="(treeView$ | async) as treeViewData">
      <ng-template #recursiveList let-categories>
        <li *ngFor="let category of categories" class="list-group-item">
          <span (click)="toggle(category)">
            {{ category.isExpanded ? '[-]' : '[+]'}} {{ category.name }}
          </span>
          <ul *ngIf="category.isExpanded" class="list-group">
            <li *ngFor="let activity of category.activities" class="list-group-item">
              {{ activity.name }}
            </li>
            <!-- Pass the jobs as categories for the next level of recursion -->
            <ng-container *ngTemplateOutlet="recursiveList; context: {$implicit: category.jobs}"></ng-container>
          </ul>
        </li>
      </ng-template>

      <!-- Initiate recursion with the top-level categories -->
      <ng-container *ngTemplateOutlet="recursiveList; context: {$implicit: treeViewData.categories}"></ng-container>
    </ng-container>

    <!-- Loading and empty state handling -->
    <app-nothing-here *ngIf="!(treeView$ | async)?.categories?.length ?? 0" [items]="[]"></app-nothing-here>
  </ul>
</div>
